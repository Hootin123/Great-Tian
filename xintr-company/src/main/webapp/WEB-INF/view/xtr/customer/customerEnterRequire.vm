<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
        "http://www.w3.org/TR/html4/strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title></title>
    #parse("comm/head.vm")
    <link rel="stylesheet" type="text/css" href="#springUrl('/resource/css/customer/customerSelector.css')"/>
    <link rel="stylesheet" type="text/css" href="#springUrl('/resource/js/plugins/laydate/need/laydate.css')"/>
    <script src="#springUrl('/resource/js/plugins/laydate/laydate.js')"></script>
    <script src="#springUrl('/resource/js/comm/validateUtil.js')"></script>
    <style>
        body,html{
            height:100%;
            width:100%;
            overflow: auto;
            position: relative;
        }

        .letLook{
            width:200px;
            height: 40px;
            margin-left: 10%;
            line-height: 36px;
            font-size: 15px;
            font-family: '微软雅黑';
            color: #f99b15;

        }
        .BtnList .okBtn{
            width:240px;
            height: 40px;
            border:0;
            border-radius: 6px;
            font-size: 16px;
            color: #fff;
            background: #0696fa;
            float: left;
            cursor: pointer;
            font-family: "微软雅黑";
        }
        .BtnList .cancelBtn{
            width:140px;
            height: 38px;
            background: #fff;
            border: 1px solid #0696fa;
            color: #0696fa;
            float:right;
            cursor: pointer;
            font-family: "微软雅黑";
        }
        .BtnList{
            width: 100%;
            height:80px;
            position: absolute;
            bottom:0;
            background:#f1f9fc;
        }
        .BtnListBtn{
            width:400px;
            height:40px;
            margin:0 auto;
            padding-top:20px;
        }
        #companyEnterRequire{
            width:80%;
            height:450px;
            margin-left:10%;
            margin-top: 50px;
            padding:30px;
            font-size:16px;
            color:#333;
        }
        .salaset-title{width: 100%; height: 80px;position: relative}
        .salaset-title h2{text-align: center;line-height: 80px;border-bottom: 1px solid #dbe9ee;color:#000;font-size:25px}
        .salaset-title .topImg{position: absolute;right:25px;top:0;bottom:0;margin:auto;cursor: pointer;}
    </style>
</head>
<body>
<div class="salaset-title">
    <h2 id="title">入职须知</h2>
    <img class="topImg" src="#springUrl('/resource/img/ture.png')" alt="" id="closeDetailBtn">
</div>
<form>
    <textarea id="companyEnterRequire"></textarea>
    <br/>
    <div class="letLook">
        <input type="checkbox" id="companyIsViewRequire">让员工查看入职须知
    </div>
    <div class="BtnList">
        <div class="BtnListBtn">
            <input class="okBtn" type="button" value="确认"/>
            <input class="cancelBtn topImg" type="button" value="取消"/>
        </div>
    </div>
</form>
</body>
<script>
    $(function () {
        if(document.body.scrollHeight <= document.body.clientHeight){
            $("body").css("min-height","700px");
        }else{
            $("body").css("min-height", 0);
        }
        //查询入职需知并显示
        initEnterRequire();
        // 绑定确定按钮事件
        $('.okBtn').on('click', function () {
//            console.log($("#companyIsViewRequire").attr("checked"));
            if($("#companyIsViewRequire").attr("checked")){
                if($("#companyEnterRequire").val()!=null && $("#companyEnterRequire").val()!=undefined && $("#companyEnterRequire").val()!=""){
                    modifyEnterRequire();
                }else{
                    layer.alert("请填入入职须知的内容", {icon: 1});
                }
            }else{
                modifyEnterRequire();
            }

        });
        //绑定取消按钮事件

        $('.topImg').click(function () {
            var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
            parent.layer.close(index);
        });

        //当入职需知有字的时候,复选框自动勾选上,无字的时候,复选框自动去掉勾选
        $("#companyEnterRequire").keyup(function(){
            var companyEnterRequireValue=$("#companyEnterRequire").val();
            if(companyEnterRequireValue!='' && companyEnterRequireValue!=undefined){
                console.log("checked");
                $("#companyIsViewRequire").attr("checked",true);
            }else{
                console.log("nochecked");
                $("#companyIsViewRequire").attr("checked",false);
            }
        });
    });
    /**
     * 查询入职需知并显示
     */
    function initEnterRequire() {
        //console.log("显示入职需知");
        $.ajax({
            type: 'post',
            url: 'queryEnterRequire.htm',
            async:true,
            success: function (resultResponse) {
               // console.log(resultResponse);
                if (resultResponse.success) {
                    var companyEnterRequire=resultResponse.data.companyEnterRequire;
//                    companyEnterRequire=companyEnterRequire.replace(/&amp;/g,"&");
//                    companyEnterRequire=companyEnterRequire.replace(/&lt;/g,"<");
//                    companyEnterRequire=companyEnterRequire.replace(/&gt;/g,">");
                    console.log(companyEnterRequire);
                    var companyIsViewRequire=resultResponse.data.companyIsViewRequire;
                    if(companyEnterRequire!=null && companyEnterRequire!=undefined){
                        $("#companyEnterRequire").html(companyEnterRequire);
                    }
                    if(companyIsViewRequire===1){
                        $("#companyIsViewRequire").attr("checked",true);
                    }
                } else {
                    layer.alert(resultResponse.message, {icon: 1});
                }
            }
        });
    }
    /**
     * 更改入职需求知
     */
    function modifyEnterRequire() {
        var params={};
        var companyEnterRequire=$("#companyEnterRequire").val();
//        companyEnterRequire=companyEnterRequire.replace(/\r\n/g,"<br/>");
//        companyEnterRequire=companyEnterRequire.replace(/\n/g,"<br/>");
//        companyEnterRequire=companyEnterRequire.replace(/\ /g,"&nbsp;");
        params["companyEnterRequire"]=companyEnterRequire;
        if($("#companyIsViewRequire").attr("checked")){
            params["companyIsViewRequire"]=1;
        }else{
            params["companyIsViewRequire"]=2;
        }
        console.log(params);
        $.ajax({
            type: 'post',
            url: 'modifyEnterRequire.htm',
            async:false,
            data:params,
            success: function (resultResponse) {
                console.log(resultResponse);
                if (resultResponse.success) {
                    var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
                    parent.layer.close(index);
                } else {
                    layer.alert(resultResponse.message, {icon: 1});
                }
            }
        });
    }
</script>
</html>