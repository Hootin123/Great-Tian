##<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
##        "http://www.w3.org/TR/html4/strict.dtd">
##
##<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
##<head>
##    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
##    <title></title>
##    #parse("comm/head.vm")
##    <link rel="stylesheet" type="text/css" href="#springUrl('/resource/css/customer/customerSelector.css')"/>
##    <link rel="stylesheet" type="text/css" href="#springUrl('/resource/js/plugins/laydate/need/laydate.css')"/>
##    <link href="#springUrl('/resource/css/customer/dropzone.css')" rel="stylesheet" />
##    <script src="#springUrl('/resource/js/plugins/laydate/laydate.js')"></script>
##    <script src="#springUrl('/resource/js/comm/validateUtil.js')"></script>
##    <script src="#springUrl('/resource/js/customer/dropzone.js')"></script>
##
##</head>
##<body>
##    <input type="hidden" id="newsImg">
##    备注：请根据下载的excel 表格填写员工资料
##    <div style="border:1px red solid;width:35%;margin-left:15%;">
##            （推荐<a href="downloadUserFile.htm?fileName=1b698242-b5a6-4d60-b6ba-c2613721c17f.xlsx">下载模板文件</a>，填写后上传）<br/>
##            <a onclick="onShowUploadRule();">点击查看上传要求</a>
##    </div>
##    <div class="dropzone dz-clickable" id="myDrop" style="width:35%;margin-left:50%;">
##
##        <div class="dz-default dz-message" data-dz-message="" style="margin-left:-500px;width:100px;height:50px;">
##            <input type="button" value="选择文件" id="uploadBtn">
##        </div>
##        #*<div class="dz-default dz-message" data-dz-message="" style="margin-left:100px;">
##            <input type="button" value="222" id="uploadBtn">
##        </div>*#
##    </div>
##    <input type="hidden" id="newsImg" name="newsImg"/>
##
####    <div id= "dropzone" style="border:1px red solid;width:300px;height:600px;">
####        <form action="customerUploadBatch.htm" class= "dropzone"  enctype= "multipart/form-data">
####            <div style="border:1px red solid;width:300px;height:300px;"></div>
####            <div style="border:1px red solid;width:300px;height:300px;"></div>
####            <div class= "fallback">
####                <input name= "file" type="file" multiple= "" /> //普通的html文件上传表单，文件类型是file，name属性用于action的属性        //注入，即imageUpload action中存在一个属性叫做“file”，保存文件内容
####            </div>
####        </form>
####    </div>
##
##    <div style="width: 160px; margin:40px auto;">
##        <input class="okBtn" type="button" value="确认提交"/>
##        <input class="cancelBtn" type="button" value="取消"/>
##    </div>
##
##</body>
##<script>
##    $(function () {
##        Dropzone.autoDiscover = false;
##        var myDropzone = new Dropzone("div#myDrop", {
##            url: "customerUploadBatch.htm",
##            acceptedFiles: ".xlsx,.xls",
##            addRemoveLinks: true,
##            maxFiles: 1,
##            dictInvalidFileType: "错误的文件格式",
##            dictRemoveFile: "移除文件",
##            dictMaxFilesExceeded: "您只可以上传1个文件"
##        });
##
##        myDropzone.on('error', function (file, errorMessage) {
##            console.log(errorMessage);
##            if(errorMessage){
##                alertWarn(errorMessage);
##            }
##        });
##
##        myDropzone.on('success', function (file, xhr) {
##            console.log(xhr);
##            if(xhr){
##                $("#newsImg").val(xhr.url);
##            }
##        });
##
##        $(".okBtn").on("click",function(){
##            $.ajax({
##                type: 'post',
##                url: 'commitUploadFile.htm',
##                async:false,
##                data:{"fileName":$("#newsImg").val()},
##                success: function (resultResponse) {
##                    console.log(resultResponse);
##                    if(resultResponse.success){
##                        layer.alert('上传成功',{
##                            title:'处理结果',
##                        },function(index){
##                            parent.loadCustomerList();
##                            var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
##                            parent.layer.close(index);
##                        });
##                    } else {
##                        layer.alert(resultResponse.message, {icon: 1});
##                    }
##                }
##            });
##        });
##
##        $(".cancelBtn").on("click",function(){
##            var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
##            parent.layer.close(index);
##        });
##    });
##
##    /**
##     * 跳转到上传规则页面
##     */
##    function onShowUploadRule(){
##        var index = layer.open({
##            type: 2,
##            title: '文件上传要求',
##            maxmin: false,
##            shadeClose: false, //点击遮罩关闭层
##            area: ['700px', '500px'],
##            content: 'toCustomerUploadRulePage.htm'
##        });
##        //窗口最大化
##//        layer.full(index);
##    }
##</script>
##</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
        "http://www.w3.org/TR/html4/strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title></title>
    #parse("comm/head.vm")
##    <link rel="stylesheet" href="css/comm/comm.css" />
##    <script type="text/javascript" src="js/comm/jquery-1.11.0.js" ></script>
    <style>
        body,html{
            width: 100%;
            height: 100%;
            position: relative;
            overflow: auto;
        }
        .importemp-title{
            position: relative;
            width:100%;
            min-width: 1200px;
            height: 80px;
            line-height: 80px;
            border-bottom: 1px solid #dbe9ee;
            color: #333333;
            text-align: center;
            overflow: hidden;
            position: relative;
        }
        .importemp-title img{
            position: absolute;
            top:0;
            bottom:0;
            right:30px;
            margin:auto;
            cursor:pointer;
        }

        .importemp-main{
            width: 1000px;
            margin: 40px auto 0;
            color: #666666;
            font-size: 12px;
        }
        .importemp-main p{
            width:100%;
            color: #f99b15;
            margin-bottom: 20px;;
        }
        .importemp-mleft,.importemp-mright{
            width: 495px;
            height: 295px;
            background: #f1f9fc;
            border: 2px dashed #dbe9ee;
            float: left;
        }

        .importemp-mright{
            border-left: none;
            background: #FFFFFF;
        }
        .importemp-mleft .imbtn{
            display: block;
            width: 200px;
            height: 36px;
            line-height: 36px;
            text-align: center;
            background: #0696FA;
            color: #FFFFFF;
            margin: 103px auto 0;
            border-radius: 6px;
            position: relative;
        }
        .importemp-file{
            opacity: 0;
            filter:alpha(opacity=70);
            width: 200px;
            height: 36px;
            position: absolute;
            left: 0;
            top: 0;
        }
        .importemp-mlemind{
            font-kerning: 14px;
            text-align: center;
            margin: 20px auto 0;
            line-height: 20px;
        }
        .importemp-mlemind a{
            color: #0696FA;
        }

        .importemp-mright .importemp-exl{
            margin: 100px auto 0;
            text-align: center;
        }
        .importemp-mright i{
            display: block;
            margin-top: 13px;
        }

        .importemp-foot{
            width: 100%;;
            min-width:1200px;
            height: 80px;
            background: #f1f9fc;
            line-height: 80px;
            position: absolute;
            bottom: 0;
        }
        .importemp-foot div{
            width: 403px;
            margin: 0 auto  ;
        }
        .importemp-foot input{
            border-radius: 8px;
            text-align: center;
            font-size: 18px;
            cursor: pointer;
        }
        .importemp-submit{
            width: 240px;
            height: 40px;
            background: #0696fa;
            color: #FFFFFF;
            line-height: 40px;
            margin-right: 20px;
            border: none;
            font-family: "微软雅黑";
        }
        .importemp-btn{
            width: 138px;
            height: 38px;
            background: none;
            color: #0696fa;
            text-align: center;
            line-height: 38px;
            border: 1px solid #0696fa;
            font-family: "微软雅黑";
        }
        .importemp-img{
            width: 0;
            height: 0;
            position: relative;
            overflow: hidden;
        }
        .importemp-delete{
            display: none;
            width: 200px;
            height: 40px;
            background: #000000;
            text-align: center;
            line-height: 40px;
            color: #FFFFFF;
            opacity: 0.5;
            position: absolute;
            left: 0;
            bottom: 0;
            cursor: pointer;
        }
    </style>
</head>
<body>
<input type="hidden" id="newsImg">
<div class="importemp-title">
    <h2>批量导入员工信息</h2>
</div>
<div class="importemp-main clear">
    <p>
    </p>
    <div class="importemp-mleft">
        <a class="imbtn" href="javascript:;">
            选择文件
            <input type="file" class="importemp-file" />
        </a>
        <div class="importemp-mlemind">（推荐<a id="tempUrl" href="#springUrl('/resource/upload/salaryfiles/template/addCustomersBatch.xlsx')">下载模板</a>文件,填写后上传）<br /><a onclick="onShowUploadRule();">[点击查看文件上传要求]</a></div>
    </div>
    <div class="importemp-mright">
        <div class="importemp-img">
            <img class="" src="#springUrl('/resource/img/customer/exl1.png')" />
            <i class="importemp-delete">删除</i>
        </div>
        <div class="importemp-exl">
            <img src="#springUrl('/resource/img/customer/exl.png')"" />
            <i>或将文件拖拽到此处</i>
        </div>
    </div>
</div>
<div class="importemp-foot">
    <div>
        <input class="importemp-submit" type="submit" value="确认提交" />
        <input class="importemp-btn" type="button" value="取消" />
    </div>
</div>
</body>
</html>
<script>
    $(function(){


    window.onresize = function(){
        if(document.body.scrollHeight <= document.body.clientHeight){
            $("body").css("min-height","600px");
        }else{
            $("body").css("min-height", 0);
        }
    }

    var submitUrl = "";
    $(function(){

        $(".importemp-submit").on("click",function(){
            if($("#newsImg").val()==null || $("#newsImg").val()==undefined || $("#newsImg").val()==""){
                layer.alert("请添加上传EXCEL文件", {icon: 1});
                return false;
            }
            layer.load();
            $.ajax({
            type: 'post',
            url: BASE_PATH + "/customerSalary/batch.htm?type=$!type",
            timeout : 50000000,
            data:{"fileName":$("#newsImg").val()},
            success: function (resultResponse) {
                layer.closeAll('loading');
                if(resultResponse.success){
                    layer.alert('上传成功',{
                        title:'处理结果',
                    },function(index){
                        parent.location.reload();
//                        parent.initData();
//                        iframe0.initData();
//                        layer.close(index);
//                        allPopClose();

                    });
                } else {
                    layer.alert(resultResponse.message, {icon: 1});
                }
            },
            error:function(data){
                layer.closeAll('loading');
            }
        });
    });

    $(".importemp-btn").on("click",function(){
        parent.location.reload();
//        parent.allPopClose();
//        var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
//        parent.layer.close(index);
    });

        var oDiv = $(".importemp-mright").get(0); //必须将jq对象转换为js对象，调用原生方法
        var oDiv1 = $(".importemp-exl");
        var oImg = $('.importemp-img');
        var reader = null
        //进入
        oDiv.ondragenter = function() {
//
        }
        //移动，需要阻止默认行为，否则直接在本页面中显示文件
        oDiv.ondragover = function(e) {
            //alert(1)
            //return false;
            e = e || event;
            e.preventDefault();
        }
        //离开
        oDiv.onleave = function() {
            oDiv1.show(); //清空内部样式！
        }
        //拖拽放置，也需要阻止默认行为
        oDiv.ondrop = function(e) {
            //console.log(e)
            e = e || event;
            e.preventDefault();

            var fs = e.dataTransfer.files; //获取拖拽过来的对象,文件对象集合

            if(fs.length > 1) {
//                alert('不能上传多个文件')
                layer.alert('不能上传多个文件', {icon: 1});
            }

            upload(fs);
        }

        /*删除事件*/
        $('.importemp-delete').click(function(){
            $("#newsImg").val("");
            fs = null;
            reader = null;
            oImg.css({'width':0,'height':0});
            $(".importemp-exl").show();
        });

//        $('.importemp-btn').click(function(){
//            console.log(reader.result);
//        });

        function upload(fs){
            //打印长度
            //console.log(fs);
            //循环多文件拖拽上传
            for(var i = 0; i < fs.length; i++) {
                //文件类型
                var _type = fs[i].name;

                //console.log(_type);
                //判断文件类型
                if(_type.indexOf('xlsx') != -1 || _type.indexOf('xls') != -1) {
                    oDiv1.hide();
                    //文件大小控制
                    //console.log(fs[i].size);
                    //读取文件对象
                    var reader = new FileReader(); //读取上传的文件
                    //读为DataUrl,无返回值
                    reader.readAsDataURL(fs[i]);
                    //console.log(reader);
                    reader.onloadstart = function(e) {

                    }
                    // 这个事件在读取进行中定时触发
                    reader.onprogress = function(e) {

//                        $("#total").html(e.total);
                    }

                    //当读取成功时触发，this.result为读取的文件数据
                    reader.onload = function() {
                        //文件数据
                        //添加文件预览
                        oImg.css({'width':200,'height':200}) //oDiv转换为js对象调用方法
//                        var oImg = $("<img style='width:100px;' src='' />");
//                        oImg.attr("src", '图片地址');
//                        $(oDiv).append(oImg); //oDiv转换为js对象调用方法
                    }
                    //无论成功与否都会触发
                    reader.onloadend = function() {

                        if(reader.error) {
                            console.log(reader.error);
                            layer.alert('上传错误', {icon: 1});
                        } else {
                            $.ajax({
                                type: 'post',
                                url: BASE_PATH+'/customerManager/customerUploadBatch.htm',
                                async:false,
                                data:{"fileCode":reader.result,"fileName":_type},
                                success: function (resultResponse) {
                                    if (resultResponse.success) {
                                        $("#newsImg").val(resultResponse.data);

                                    } else {
                                        showWarning(resultResponse.message);
                                    }
                                }
                            });
                            //上传没有错误，ajax发送文件，上传二进制文件
                        }
                    }
                } else {
//                    alert('请上exc表格！');
                    layer.alert('请上exc表格！', {icon: 1});
                }
            }
        }

        $('.importemp-img').mouseover(function(){
            $('.importemp-delete').show();
            //alert(1)
        })

        $('.importemp-img').mouseout(function(){
            $('.importemp-delete').hide();
        })


        /*按钮上传*/

        $('.importemp-file').get(0).onchange = function(){
            var myurl = this.files;console.log(myurl.name)
            upload(myurl);

        }
    });
    /**
     * 跳转到上传规则页面
     */
    function onShowUploadRule(){
        var index = layer.open({
            type: 2,
            title: '文件上传要求',
            maxmin: false,
            shadeClose: false, //点击遮罩关闭层
            area: ['700px', '500px'],
            content: BASE_PATH + '/customerManager/toCustomerUploadRulePage.htm'
        });
        //窗口最大化
        //        layer.full(index);
    }

    function initLayout(type){
        if(type == 1){
            $(".importemp-title").html("批量定薪");
            $("#tempUrl").attr("href", "#springUrl('/resource/upload/salaryfiles/template/BatchSetSalary.xlsx')");
            $('.importemp-main p').html("注1：可一次性给多名未定薪的正式或劳务员工定薪（即初始化基本工资）。<br/>注2：如想为已定薪员工调薪，请在“批量调薪”中操作。")
        }else if(type == 2){
            $(".importemp-title").html("批量调薪");
            $("#tempUrl").attr("href", "#springUrl('/resource/upload/salaryfiles/template/BatchUpdateSalary.xlsx')");
            $('.importemp-main p').html("注1：可一次性给多名正式或劳务员工调薪。<br/>注2：如想为未定薪员工定薪，请在“批量定薪”中操作。")
        }else if(type == 3){
            $(".importemp-title").html("批量补充工资明细");
            $("#tempUrl").attr("href", "#springUrl('/resource/upload/salaryfiles/template/BatchSetTax.xlsx')");
            $('.importemp-main p').html("注1：可一次性给多名正式或劳务员工更新奖金、税前补发/扣款、税后补发/扣款。<br/>注2：只需上传需要调整的员工数据，将按照上传数据更新。不在列表中的人员将不更新，不填的项将不更新，字段数据为“0”将清除原数据。")
        }else if(type == 4){
            $(".importemp-title").html("批量设置考勤天数");
            $("#tempUrl").attr("href", "#springUrl('/resource/upload/salaryfiles/template/BatchSetDay.xlsx')");
            $('.importemp-main p').html("注1：可一次性上传多名已定薪员工的本月考勤数据。<br/>注2：如果已有某员工的考勤数据，再次上传，最新上传的会覆盖原有数据。不在列表中的人员将不更新，不填的项将不更新，字段数据为“0”将清除原数据。")
        }
    }
    initLayout($type)

    });

    //取消关闭
    $('#closeDetailBtn').click(function () {
        parent.location.reload();
    })
</script>