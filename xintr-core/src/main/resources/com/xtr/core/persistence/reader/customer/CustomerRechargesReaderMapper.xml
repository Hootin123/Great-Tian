<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xtr.core.persistence.reader.customer.CustomerRechargesReaderMapper">

    <resultMap id="BaseResultMap" type="com.xtr.api.domain.customer.CustomerRechargesBean">
        <id column="recharge_id" jdbcType="BIGINT" property="rechargeId"/>
        <result column="recharge_type" jdbcType="INTEGER" property="rechargeType"/>
        <result column="recharge_money" jdbcType="DECIMAL" property="rechargeMoney"/>
        <result column="recharge_customer_id" jdbcType="BIGINT" property="rechargeCustomerId"/>
        <result column="recharge_addtime" jdbcType="TIMESTAMP" property="rechargeAddtime"/>
        <result column="recharge_number" jdbcType="VARCHAR" property="rechargeNumber"/>
        <result column="batch_number" jdbcType="VARCHAR" property="batchNumber"/>
        <result column="recharge_bak" jdbcType="VARCHAR" property="rechargeBak"/>
        <result column="recharge_station" jdbcType="INTEGER" property="rechargeStation"/>
        <result column="recharge_client" jdbcType="INTEGER" property="rechargeClient"/>
        <result column="recharge_moneyserver" jdbcType="DECIMAL" property="rechargeMoneyserver"/>
        <result column="recharge_bank" jdbcType="VARCHAR" property="rechargeBank"/>
        <result column="recharge_bankarea" jdbcType="VARCHAR" property="rechargeBankarea"/>
        <result column="recharge_banknumber" jdbcType="VARCHAR" property="rechargeBanknumber"/>
        <result column="recharge_moneynow" jdbcType="DECIMAL" property="rechargeMoneynow"/>
        <result column="recharge_istoexcel" jdbcType="INTEGER" property="rechargeIstoexcel"/>
        <result column="recharge_moneybt" jdbcType="DECIMAL" property="rechargeMoneybt"/>
        <result column="recharge_istorecord" jdbcType="INTEGER" property="rechargeIstorecord"/>
        <result column="recharge_recall_time" jdbcType="TIMESTAMP" property="rechargeRecallTime"/>
        <result column="recharge_recall_result" jdbcType="INTEGER" property="rechargeRecallResult"/>
        <result column="recharge_state" jdbcType="INTEGER" property="rechargeState"/>
        <result column="recharge_audit_first_time" jdbcType="TIMESTAMP" property="rechargeAuditFirstTime"/>
        <result column="recharge_audit_first_member" jdbcType="BIGINT" property="rechargeAuditFirstMember"/>
        <result column="recharge_audit_first_remark" jdbcType="VARCHAR" property="rechargeAuditFirstRemark"/>
        <result column="recharge_audit_second_time" jdbcType="TIMESTAMP" property="rechargeAuditSecondTime"/>
        <result column="recharge_audit_second_remark" jdbcType="VARCHAR" property="rechargeAuditSecondRemark"/>
        <result column="recharge_audit_second_member" jdbcType="BIGINT" property="rechargeAuditSecondMember"/>
        <result column="resource_id" jdbcType="BIGINT" property="resourceId"/>
    </resultMap>
    <sql id="Base_Column_List">
    recharge_id, recharge_type, recharge_money, recharge_customer_id, recharge_addtime,
    recharge_number, batch_number, recharge_bak, recharge_station, recharge_client, recharge_moneyserver,
    recharge_bank, recharge_bankarea, recharge_banknumber, recharge_moneynow, recharge_istoexcel, 
    recharge_moneybt, recharge_istorecord, recharge_recall_time, recharge_recall_result, 
    recharge_state, recharge_audit_first_time, recharge_audit_first_member, recharge_audit_first_remark, 
    recharge_audit_second_time, recharge_audit_second_remark, recharge_audit_second_member, resource_id
  </sql>
    <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from customer_recharges
        where recharge_id = #{rechargeId,jdbcType=BIGINT}
    </select>

    <resultMap id="CustomWithDrawlsBatchMap" type="com.xtr.api.dto.customer.CustomWithDrawlsBatchDto">
        <result column="batch_number" jdbcType="VARCHAR" property="batchNumber"/>
        <result column="first_time" jdbcType="TIMESTAMP" property="firstTime"/>
        <result column="end_time" jdbcType="TIMESTAMP" property="endTime"/>
        <result column="batch_money" jdbcType="DECIMAL" property="batchMoney"/>
        <result column="batch_count" jdbcType="INTEGER" property="batchCount"/>
        <result column="recharge_state" jdbcType="INTEGER" property="rechargeState"/>
        <result column="audit_name" jdbcType="VARCHAR" property="auditName"/>
    </resultMap>

    <!--分页查询个人提现批次-->
    <select id="selectBatchPageList" resultMap="CustomWithDrawlsBatchMap">
        select batch_number,min(a.recharge_addtime) as first_time, max(a.recharge_addtime) as end_time,
        sum(a.recharge_money) as batch_money,count(a.recharge_id) as batch_count, a.recharge_state,
        b.nick_name as audit_name
        from customer_recharges as a
        left join sys_user as b on a.recharge_audit_first_member = b.id
        where 1=1
        <if test="startTime != null and startTime != ''">
            and a.recharge_addtime &gt;= date(#{startTime,jdbcType=VARCHAR})
        </if>
        <if test="state != null">
            and a.recharge_state = #{state,jdbcType=INTEGER}
        </if>
        <if test="auditName != null and auditName != ''">
            and b.nick_name = #{auditName,jdbcType=VARCHAR}
        </if>
        group by a.batch_number
        order by a.recharge_addtime desc
    </select>

    <sql id="Example_Where_Clause">
        <if test="rechargeType != null">
            AND recharge_type = #{rechargeType,jdbcType=INTEGER}
        </if>
        <if test="rechargeMoney != null">
            AND recharge_money = #{rechargeMoney,jdbcType=DECIMAL}
        </if>
        <if test="rechargeCustomerId != null">
            AND recharge_customer_id = #{rechargeCustomerId,jdbcType=BIGINT}
        </if>
        <if test="rechargeAddtime != null">
            AND recharge_addtime = #{rechargeAddtime,jdbcType=TIMESTAMP}
        </if>
        <if test="rechargeNumber != null">
            AND recharge_number = #{rechargeNumber,jdbcType=VARCHAR}
        </if>
        <if test="batchNumber != null">
            AND batch_number = #{batchNumber,jdbcType=VARCHAR}
        </if>
        <if test="rechargeBak != null">
            AND recharge_bak = #{rechargeBak,jdbcType=VARCHAR}
        </if>
        <if test="rechargeStation != null">
            AND recharge_station = #{rechargeStation,jdbcType=INTEGER}
        </if>
        <if test="rechargeClient != null">
            AND recharge_client = #{rechargeClient,jdbcType=INTEGER}
        </if>
        <if test="rechargeMoneyserver != null">
            AND recharge_moneyserver = #{rechargeMoneyserver,jdbcType=DECIMAL}
        </if>
        <if test="rechargeBank != null">
            AND recharge_bank = #{rechargeBank,jdbcType=VARCHAR}
        </if>
        <if test="rechargeBankarea != null">
            AND recharge_bankarea = #{rechargeBankarea,jdbcType=VARCHAR}
        </if>
        <if test="rechargeBanknumber != null">
            AND recharge_banknumber = #{rechargeBanknumber,jdbcType=VARCHAR}
        </if>
        <if test="rechargeMoneynow != null">
            AND recharge_moneynow = #{rechargeMoneynow,jdbcType=DECIMAL}
        </if>
        <if test="rechargeIstoexcel != null">
            AND recharge_istoexcel = #{rechargeIstoexcel,jdbcType=INTEGER}
        </if>
        <if test="rechargeMoneybt != null">
            AND recharge_moneybt = #{rechargeMoneybt,jdbcType=DECIMAL}
        </if>
        <if test="rechargeIstorecord != null">
            AND recharge_istorecord = #{rechargeIstorecord,jdbcType=INTEGER}
        </if>
        <if test="rechargeRecallTime != null">
            AND recharge_recall_time = #{rechargeRecallTime,jdbcType=TIMESTAMP}
        </if>
        <if test="rechargeRecallResult != null">
            AND recharge_recall_result = #{rechargeRecallResult,jdbcType=INTEGER}
        </if>
        <if test="rechargeState != null">
            AND recharge_state = #{rechargeState,jdbcType=INTEGER}
        </if>
        <if test="rechargeAuditFirstTime != null">
            AND recharge_audit_first_time = #{rechargeAuditFirstTime,jdbcType=TIMESTAMP}
        </if>
        <if test="rechargeAuditFirstMember != null">
            AND recharge_audit_first_member = #{rechargeAuditFirstMember,jdbcType=BIGINT}
        </if>
        <if test="rechargeAuditFirstRemark != null">
            AND recharge_audit_first_remark = #{rechargeAuditFirstRemark,jdbcType=VARCHAR}
        </if>
        <if test="rechargeAuditSecondTime != null">
            AND recharge_audit_second_time = #{rechargeAuditSecondTime,jdbcType=TIMESTAMP}
        </if>
        <if test="rechargeAuditSecondRemark != null">
            AND recharge_audit_second_remark = #{rechargeAuditSecondRemark,jdbcType=VARCHAR}
        </if>
        <if test="rechargeAuditSecondMember != null">
            AND recharge_audit_second_member = #{rechargeAuditSecondMember,jdbcType=BIGINT}
        </if>
    </sql>

    <!-- 分页查询 -->
    <select id="selectPageList" resultMap="BaseResultMap"
            parameterType="com.xtr.api.domain.customer.CustomerRechargesBean">
        SELECT
        <include refid="Base_Column_List"/>
        FROM customer_recharges
        WHERE 1=1
        <include refid="Example_Where_Clause"/>
        order by recharge_addtime desc
    </select>

    <!-- 员工提现详情 -->
    <resultMap id="CustomerReachrgeMap" type="com.xtr.api.dto.customer.CustomerReachrgeDto" extends="BaseResultMap">
        <result column="login_name" property="loginName"/>
        <result column="uname" property="uname"/>
        <result column="mobile" property="mobile"/>
        <result column="id_card" property="idCard"/>
        <result column="company_id" property="companyId"/>
        <result column="audit_name" property="auditName"/>
    </resultMap>

    <!-- 查询个人提现充值列表 -->
    <select id="selectDetailList" resultMap="CustomerReachrgeMap" parameterType="java.lang.String">
        SELECT
        <include refid="Base_Column_List"/>,
        b.customer_logname as login_name, b.customer_turename as uname,
        b.customer_idcard as id_card, b.customer_phone as mobile,
        b.customer_company_id as company_id,
        c.nick_name as audit_name
        FROM customer_recharges as a
        LEFT JOIN customers as b on a.recharge_customer_id = b.customer_id
        LEFT JOIN sys_user as c on a.recharge_audit_first_member = c.id
        WHERE 1=1
        <if test="batchNumber != null and batchNumber != ''">
            and a.batch_number = #{batchNumber}
        </if>
        order by a.recharge_addtime desc
    </select>

    <!--查询今天的订单量-->
    <select id="getTodayOrderNum" resultType="java.lang.Integer">
    select count(recharge_id) from customer_recharges
    where to_days(recharge_addtime) = to_days(now()) and recharge_type = #{rechargeType,jdbcType=INTEGER}
  </select>

    <!-- 根据第三方平台获取所有待审批的提现申请-->
    <select id="getAllWithdrawals" resultMap="BaseResultMap" parameterType="java.lang.Integer">
        SELECT
        <include refid="Base_Column_List"/>
        FROM customer_recharges
        WHERE recharge_state = 0
        AND recharge_type = 2
        AND recharge_station = #{rechargeStation,jdbcType=INTEGER}
        order by recharge_addtime asc
    </select>

  <select id="selectByNumber" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from customer_recharges
    where recharge_number = #{rNumber}
  </select>

  <!-- 根据第三方平台获取所有社保公积金补退的提现申请-->
  <select id="getBackWithdrawals" resultMap="BaseResultMap" parameterType="java.lang.Integer">
    SELECT
    <include refid="Base_Column_List"/>
    FROM customer_recharges
    WHERE recharge_state = 0 and recharge_type=8
    AND recharge_station = #{rechargeStation,jdbcType=INTEGER}
    order by recharge_addtime asc
  </select>
</mapper>