<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xtr.core.persistence.writer.salary.CustomerPayrollWriterMapper">

    <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        delete from customer_payroll
        where id = #{id,jdbcType=BIGINT}
    </delete>
    <insert id="insert" parameterType="com.xtr.api.domain.salary.CustomerPayrollBean" useGeneratedKeys="true"
            keyProperty="id">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into customer_payroll (id, customer_id, dept_id,
        company_id, pay_cycle_id,base_wages, add_wages,
        attendance_deduction, absence_day_number,
        total_allowance,total_bonus, social_security_fund, social_security,
        fund, pretax, should_amount,
        personal_tax, after_tax, real_wage,
        create_time, is_allowance_update, is_bonus_update,
        is_payrule_update,is_pay_off, pay_status,wiped_amount,appraisals_supplement,
        bonus_json_str,allowance_json_str,social_security_fund_corp)
        values (#{id,jdbcType=BIGINT}, #{customerId,jdbcType=BIGINT}, #{deptId,jdbcType=BIGINT},
        #{companyId,jdbcType=BIGINT},#{payCycleId,jdbcType=BIGINT}, #{baseWages,jdbcType=DECIMAL},
        #{addWages,jdbcType=DECIMAL},
        #{attendanceDeduction,jdbcType=DECIMAL}, #{absenceDayNumber,jdbcType=DECIMAL},
        #{totalAllowance,jdbcType=DECIMAL},#{totalBonus,jdbcType=DECIMAL}, #{socialSecurityFund,jdbcType=DECIMAL},
        #{socialSecurity,jdbcType=DECIMAL},
        #{fund,jdbcType=DECIMAL}, #{pretax,jdbcType=DECIMAL}, #{shouldAmount,jdbcType=DECIMAL},
        #{personalTax,jdbcType=DECIMAL}, #{afterTax,jdbcType=DECIMAL}, #{realWage,jdbcType=DECIMAL},
        #{createTime,jdbcType=TIMESTAMP}, #{isAllowanceUpdate,jdbcType=INTEGER}, #{isBonusUpdate,jdbcType=INTEGER},
        #{isPayruleUpdate,jdbcType=INTEGER},#{isPayOff,jdbcType=INTEGER},#{payStatus,jdbcType=INTEGER},
        #{wipedAmount,jdbcType=DECIMAL},#{appraisalsSupplement,jdbcType=DECIMAL},#{bonusJsonStr,jdbcType=VARCHAR},
        #{allowanceJsonStr,jdbcType=VARCHAR},#{socialSecurityFundCorp,jdbcType=DECIMAL})
    </insert>
    <insert id="insertSelective" parameterType="com.xtr.api.domain.salary.CustomerPayrollBean" useGeneratedKeys="true"
            keyProperty="id">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into customer_payroll
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                id,
            </if>
            <if test="customerId != null">
                customer_id,
            </if>
            <if test="deptId != null">
                dept_id,
            </if>
            <if test="companyId != null">
                company_id,
            </if>
            <if test="payCycleId != null">
                pay_cycle_id,
            </if>
            <if test="baseWages != null">
                base_wages,
            </if>
            <if test="addWages != null">
                add_wages,
            </if>
            <if test="attendanceDeduction != null">
                attendance_deduction,
            </if>
            <if test="absenceDayNumber != null">
                absence_day_number,
            </if>
            <if test="totalAllowance != null">
                total_allowance,
            </if>
            <if test="totalBonus != null">
                total_bonus,
            </if>
            <if test="socialSecurityFund != null">
                social_security_fund,
            </if>
            <if test="socialSecurity != null">
                social_security,
            </if>
            <if test="fund != null">
                fund,
            </if>
            <if test="pretax != null">
                pretax,
            </if>
            <if test="shouldAmount != null">
                should_amount,
            </if>
            <if test="personalTax != null">
                personal_tax,
            </if>
            <if test="afterTax != null">
                after_tax,
            </if>
            <if test="realWage != null">
                real_wage,
            </if>
            <if test="createTime != null">
                create_time,
            </if>
            <if test="isAllowanceUpdate != null">
                is_allowance_update,
            </if>
            <if test="isBonusUpdate != null">
                is_bonus_update,
            </if>
            <if test="isPayruleUpdate != null">
                is_payrule_update,
            </if>
            <if test="isPayOff != null">
                is_pay_off,
            </if>
            <if test="payStatus != null">
                pay_status,
            </if>
            <if test="wipedAmount != null">
                wiped_amount,
            </if>
            <if test="appraisalsSupplement != null">
                appraisals_supplement,
            </if>
            <if test="bonusJsonStr != null">
                bonus_json_str,
            </if>
            <if test="allowanceJsonStr != null">
                allowance_json_str,
            </if>
            <if test="socialSecurityFundCorp != null">
                social_security_fund_corp,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=BIGINT},
            </if>
            <if test="customerId != null">
                #{customerId,jdbcType=BIGINT},
            </if>
            <if test="deptId != null">
                #{deptId,jdbcType=BIGINT},
            </if>
            <if test="companyId != null">
                #{companyId,jdbcType=BIGINT},
            </if>
            <if test="payCycleId != null">
                #{payCycleId,jdbcType=BIGINT},
            </if>
            <if test="baseWages != null">
                #{baseWages,jdbcType=DECIMAL},
            </if>
            <if test="addWages != null">
                #{addWages,jdbcType=DECIMAL},
            </if>
            <if test="attendanceDeduction != null">
                #{attendanceDeduction,jdbcType=DECIMAL},
            </if>
            <if test="absenceDayNumber != null">
                #{absenceDayNumber,jdbcType=DECIMAL},
            </if>
            <if test="totalAllowance != null">
                #{totalAllowance,jdbcType=DECIMAL},
            </if>
            <if test="totalBonus != null">
                #{totalBonus,jdbcType=DECIMAL},
            </if>
            <if test="socialSecurityFund != null">
                #{socialSecurityFund,jdbcType=DECIMAL},
            </if>
            <if test="socialSecurity != null">
                #{socialSecurity,jdbcType=DECIMAL},
            </if>
            <if test="fund != null">
                #{fund,jdbcType=DECIMAL},
            </if>
            <if test="pretax != null">
                #{pretax,jdbcType=DECIMAL},
            </if>
            <if test="shouldAmount != null">
                #{shouldAmount,jdbcType=DECIMAL},
            </if>
            <if test="personalTax != null">
                #{personalTax,jdbcType=DECIMAL},
            </if>
            <if test="afterTax != null">
                #{afterTax,jdbcType=DECIMAL},
            </if>
            <if test="realWage != null">
                #{realWage,jdbcType=DECIMAL},
            </if>
            <if test="createTime != null">
                #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="isAllowanceUpdate != null">
                #{isAllowanceUpdate,jdbcType=INTEGER},
            </if>
            <if test="isBonusUpdate != null">
                #{isBonusUpdate,jdbcType=INTEGER},
            </if>
            <if test="isPayruleUpdate != null">
                #{isPayruleUpdate,jdbcType=INTEGER},
            </if>
            <if test="isPayOff != null">
                #{isPayOff,jdbcType=INTEGER},
            </if>
            <if test="payStatus != null">
                #{payStatus,jdbcType=INTEGER},
            </if>
            <if test="wipedAmount != null">
                #{wipedAmount,jdbcType=DECIMAL},
            </if>
            <if test="appraisalsSupplement != null">
                #{appraisalsSupplement,jdbcType=DECIMAL},
            </if>
            <if test="bonusJsonStr != null">
                #{bonusJsonStr,jdbcType=VARCHAR},
            </if>
            <if test="allowanceJsonStr != null">
                #{allowanceJsonStr,jdbcType=VARCHAR},
            </if>
            <if test="socialSecurityFundCorp != null">
                #{socialSecurityFundCorp,jdbcType=DECIMAL},
            </if>
        </trim>
    </insert>
    <update id="updateByPrimaryKeySelective" parameterType="com.xtr.api.domain.salary.CustomerPayrollBean">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update customer_payroll
        <set>
            <if test="customerId != null">
                customer_id = #{customerId,jdbcType=BIGINT},
            </if>
            <if test="deptId != null">
                dept_id = #{deptId,jdbcType=BIGINT},
            </if>
            <if test="companyId != null">
                company_id = #{companyId,jdbcType=BIGINT},
            </if>
            <if test="payCycleId != null">
                pay_cycle_id = #{payCycleId,jdbcType=BIGINT},
            </if>
            <if test="baseWages != null">
                base_wages = #{baseWages,jdbcType=DECIMAL},
            </if>
            <if test="addWages != null">
                add_wages = #{addWages,jdbcType=DECIMAL},
            </if>
            <if test="attendanceDeduction != null">
                attendance_deduction = #{attendanceDeduction,jdbcType=DECIMAL},
            </if>
            <if test="absenceDayNumber != null">
                absence_day_number = #{absenceDayNumber,jdbcType=DECIMAL},
            </if>
            <if test="totalAllowance != null">
                total_allowance = #{totalAllowance,jdbcType=DECIMAL},
            </if>
            <if test="totalBonus != null">
                total_bonus = #{totalBonus,jdbcType=DECIMAL},
            </if>
            <if test="socialSecurityFund != null">
                social_security_fund = #{socialSecurityFund,jdbcType=DECIMAL},
            </if>
            <if test="socialSecurity != null">
                social_security = #{socialSecurity,jdbcType=DECIMAL},
            </if>
            <if test="fund != null">
                fund = #{fund,jdbcType=DECIMAL},
            </if>
            <if test="pretax != null">
                pretax = #{pretax,jdbcType=DECIMAL},
            </if>
            <if test="shouldAmount != null">
                should_amount = #{shouldAmount,jdbcType=DECIMAL},
            </if>
            <if test="personalTax != null">
                personal_tax = #{personalTax,jdbcType=DECIMAL},
            </if>
            <if test="afterTax != null">
                after_tax = #{afterTax,jdbcType=DECIMAL},
            </if>
            <if test="realWage != null">
                real_wage = #{realWage,jdbcType=DECIMAL},
            </if>
            <if test="createTime != null">
                create_time = #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="isAllowanceUpdate != null">
                is_allowance_update = #{isAllowanceUpdate,jdbcType=INTEGER},
            </if>
            <if test="isBonusUpdate != null">
                is_bonus_update = #{isBonusUpdate,jdbcType=INTEGER},
            </if>
            <if test="isPayruleUpdate != null">
                is_payrule_update = #{isPayruleUpdate,jdbcType=INTEGER},
            </if>
            <if test="isPayOff != null">
                is_pay_off = #{isPayOff,jdbcType=INTEGER},
            </if>
            <if test="payStatus != null">
                pay_status = #{payStatus,jdbcType=INTEGER},
            </if>
            <if test="remark != null">
                remark = #{remark},
            </if>
            <if test="financeUser != null">
                finance_user = #{financeUser},
            </if>
            <if test="failMsg != null">
                fail_msg = #{failMsg},
            </if>
            <if test="wipedAmount != null">
                wiped_amount = #{wipedAmount},
            </if>
            <if test="appraisalsSupplement != null">
                appraisals_supplement = #{appraisalsSupplement},
            </if>
            <if test="bonusJsonStr != null">
                bonus_json_str = #{bonusJsonStr,jdbcType=VARCHAR},
            </if>
            <if test="allowanceJsonStr != null">
                allowance_json_str = #{allowanceJsonStr,jdbcType=VARCHAR},
            </if>
            <if test="socialSecurityFundCorp != null">
                social_security_fund_corp = #{socialSecurityFundCorp,jdbcType=DECIMAL},
            </if>
        </set>
        where id = #{id,jdbcType=BIGINT}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.xtr.api.domain.salary.CustomerPayrollBean">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update customer_payroll
        set customer_id = #{customerId,jdbcType=BIGINT},
        dept_id = #{deptId,jdbcType=BIGINT},
        company_id = #{companyId,jdbcType=BIGINT},
        pay_cycle_id = #{payCycleId,jdbcType=BIGINT},
        base_wages = #{baseWages,jdbcType=DECIMAL},
        add_wages = #{addWages,jdbcType=DECIMAL},
        attendance_deduction = #{attendanceDeduction,jdbcType=DECIMAL},
        absence_day_number = #{absenceDayNumber,jdbcType=DECIMAL},
        total_allowance = #{totalAllowance,jdbcType=DECIMAL},
        total_bonus = #{totalBonus,jdbcType=DECIMAL},
        social_security_fund = #{socialSecurityFund,jdbcType=DECIMAL},
        social_security = #{socialSecurity,jdbcType=DECIMAL},
        fund = #{fund,jdbcType=DECIMAL},
        pretax = #{pretax,jdbcType=DECIMAL},
        should_amount = #{shouldAmount,jdbcType=DECIMAL},
        personal_tax = #{personalTax,jdbcType=DECIMAL},
        after_tax = #{afterTax,jdbcType=DECIMAL},
        real_wage = #{realWage,jdbcType=DECIMAL},
        create_time = #{createTime,jdbcType=TIMESTAMP},
        is_allowance_update = #{isAllowanceUpdate,jdbcType=INTEGER},
        is_bonus_update = #{isBonusUpdate,jdbcType=INTEGER},
        is_payrule_update = #{isPayruleUpdate,jdbcType=INTEGER},
        is_pay_off = #{isPayOff,jdbcType=INTEGER},
        pay_status = #{payStatus,jdbcType=INTEGER},
        wiped_amount = #{wipedAmount},
        appraisals_supplement = #{appraisalsSupplement},
        bonus_json_str = #{bonusJsonStr,jdbcType=VARCHAR},
        allowance_json_str = #{allowanceJsonStr,jdbcType=VARCHAR},
        social_security_fund_corp = #{socialSecurityFundCorp,jdbcType=DECIMAL}
        where id = #{id,jdbcType=BIGINT}
    </update>

    <update id="updateTaxByCyclIdAndCustomerId">
        update customer_payroll
        set
        pretax = #{preTax},
        after_tax = #{afterTax},
        social_security = #{sb},
        social_security_fund = #{gjj}
        where
        customer_id = #{customerId}
        AND
        pay_cycle_id = #{payCycleId}
    </update>

    <update id="updateAbsenceDayByCyclIdAndCustomerId">
        update customer_payroll
        set
        absence_day_number = #{days}
        where
        customer_id = #{customerId}
        AND
        pay_cycle_id = #{payCycleId}
    </update>

    <update id="updateAllow">
        update customer_payroll set
        <if test="type == 1">
            is_allowance_update
        </if>
        <if test="type == 2">
            is_bonus_update
        </if>
        <if test="type == 3">
            is_payrule_update
        </if>
        = 1 where pay_cycle_id = #{paycycleId}
    </update>

    <update id="updatePayRollStatus">
        update customer_payroll
        set is_payrule_update = 1
        where
        customer_id = #{customerId}
        and pay_cycle_id = #{cycleId}
    </update>
    <update id="updatePayRollStatusByCycle">
        update customer_payroll
        set is_payrule_update = 1
        where
        pay_cycle_id = #{cycleId}
    </update>

    <!--根据人员id、公司id、计薪周期id删除工资单-->
    <delete id="deleteByCustomerId">
        delete from customer_payroll
        where company_id = #{companyId,jdbcType=BIGINT}
        and customer_id = #{customerId,jdbcType=BIGINT}
        and pay_cycle_id = #{cycleId,jdbcType=BIGINT}
    </delete>

    <!--更新员工工资单的三个状态-->
    <update id="updatePayRollThreeStatus">
        update customer_payroll
        set is_allowance_update=1,
        is_bonus_update=1,
        is_payrule_update = 1
        where
        customer_id = #{customerId}
        and pay_cycle_id = #{cycleId}
    </update>
</mapper>