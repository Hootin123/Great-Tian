<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xtr.core.persistence.reader.company.CompanyBorrowBillsReaderMapper" >
  <resultMap id="BaseResultMap" type="com.xtr.api.domain.company.CompanyBorrowBillsBean" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="bill_id" property="billId" jdbcType="BIGINT" />
    <result column="bill_index" property="billIndex" jdbcType="INTEGER" />
    <result column="bill_borrow_order_id" property="billBorrowOrderId" jdbcType="BIGINT" />
    <result column="bill_company_id" property="billCompanyId" jdbcType="BIGINT" />
    <result column="bill_dep_id" property="billDepId" jdbcType="BIGINT" />
    <result column="bill_money" property="billMoney" jdbcType="DECIMAL" />
    <result column="bill_money_base" property="billMoneyBase" jdbcType="DECIMAL" />
    <result column="bill_money_interest" property="billMoneyInterest" jdbcType="DECIMAL" />
    <result column="bill_money_break" property="billMoneyBreak" jdbcType="DECIMAL" />
    <result column="bill_addtime" property="billAddtime" jdbcType="TIMESTAMP" />
    <result column="bill_repaytime" property="billRepaytime" jdbcType="TIMESTAMP" />
    <result column="bill_actual_repaytime" property="billActualRepaytime" jdbcType="TIMESTAMP" />
    <result column="bill_sign" property="billSign" jdbcType="INTEGER" />
    <result column="bill_islast" property="billIslast" jdbcType="INTEGER" />
    <result column="tran_id" property="tranId" jdbcType="BIGINT" />
    <result column="bill_money_break_coupon" property="billMoneyBreakCoupon" jdbcType="DECIMAL" />
    <result column="bill_break_edit_remark" property="billBreakEditRemark" jdbcType="VARCHAR" />
    <result column="bill_remind_payments_count" property="billRemindPaymentsCount" jdbcType="INTEGER" />
  </resultMap>

    <resultMap id="CompanyRepayAccountResaultMap" type="com.xtr.api.dto.company.CompanyRepayAccountDto">
        <id column="bill_id" property="billId" jdbcType="BIGINT"/>
        <result column="order_id" property="orderId" jdbcType="BIGINT"/>
        <result column="bill_money" property="billMoney" jdbcType="DECIMAL"/>
        <result column="bill_repaytime" property="biilRepaytime" jdbcType="TIMESTAMP"/>
        <result column="bill_addtime" property="billAddtime" jdbcType="TIMESTAMP"/>
        <result column="description" property="description" jdbcType="VARCHAR"/>
    </resultMap>
  
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    bill_id, bill_index, bill_borrow_order_id, bill_company_id, bill_dep_id, bill_money, 
    bill_money_base, bill_money_interest, bill_money_break, bill_addtime, bill_repaytime, 
    bill_actual_repaytime, bill_sign, bill_islast, tran_id, bill_money_break_coupon, 
    bill_break_edit_remark, bill_remind_payments_count
  </sql>
  
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select
    <include refid="Base_Column_List" />
    from company_borrow_bills
    where bill_id = #{billId,jdbcType=BIGINT}
  </select>
  
  <!-- 根据企业借款订单id查询账单列表 -->
  <select id="selectListByOrderId" resultMap="BaseResultMap" parameterType="java.lang.Long">
    SELECT 
    <include refid="Base_Column_List" />
    from company_borrow_bills
    WHERE  bill_borrow_order_id = #{borrowOrderId,jdbcType=BIGINT}
  </select>
  
  <sql id="Example_Where_Clause">
      <where>
          <trim prefix="AND" suffixOverrides=",">
              <if test="billIndex != null">
                  bill_index = #{billIndex,jdbcType=INTEGER},
              </if>
              <if test="billBorrowOrderId != null">
                  bill_borrow_order_id = #{billBorrowOrderId,jdbcType=BIGINT},
              </if>
              <if test="billCompanyId != null">
                  bill_company_id = #{billCompanyId,jdbcType=BIGINT},
              </if>
              <if test="billDepId != null">
                  bill_dep_id = #{billDepId,jdbcType=BIGINT},
              </if>
              <if test="billMoney != null">
                  bill_money = #{billMoney,jdbcType=DECIMAL},
              </if>
              <if test="billMoneyBase != null">
                  bill_money_base = #{billMoneyBase,jdbcType=DECIMAL},
              </if>
              <if test="billMoneyInterest != null">
                  bill_money_interest = #{billMoneyInterest,jdbcType=DECIMAL},
              </if>
              <if test="billMoneyBreak != null">
                  bill_money_break = #{billMoneyBreak,jdbcType=DECIMAL},
              </if>
              <if test="billAddtime != null">
                  bill_addtime = #{billAddtime,jdbcType=TIMESTAMP},
              </if>
              <if test="billRepaytime != null">
                  bill_repaytime = #{billRepaytime,jdbcType=TIMESTAMP},
              </if>
              <if test="billActualRepaytime != null">
                  bill_actual_repaytime = #{billActualRepaytime,jdbcType=TIMESTAMP},
              </if>
              <if test="billSign != null">
                  bill_sign = #{billSign,jdbcType=INTEGER},
              </if>
              <if test="billIslast != null">
                  bill_islast = #{billIslast,jdbcType=INTEGER},
              </if>
              <if test="tranId != null">
                  tran_id = #{tranId,jdbcType=BIGINT},
              </if>
              <if test="billMoneyBreakCoupon != null">
                  bill_money_break_coupon = #{billMoneyBreakCoupon,jdbcType=DECIMAL},
              </if>
              <if test="billBreakEditRemark != null">
                  bill_break_edit_remark = #{billBreakEditRemark,jdbcType=VARCHAR},
              </if>
              <if test="billRemindPaymentsCount != null">
                  bill_remind_payments_count = #{billRemindPaymentsCount,jdbcType=INTEGER},
              </if>
          </trim>
      </where>
  </sql>

    <sql id="Criteria_Where_Clause">
        <where>
            <foreach collection="generic" item="criteria" separator="or">
                <if test="criteria.valid">
                    <trim prefix="(" suffix=")" prefixOverrides="and">
                        <foreach collection="criteria.criteria" item="criterion">
                            <choose>
                                <when test="criterion.noValue">
                                    and ${criterion.condition}
                                </when>
                                <when test="criterion.singleValue">
                                    and ${criterion.condition} #{criterion.value}
                                </when>
                                <when test="criterion.betweenValue">
                                    and ${criterion.condition} #{criterion.value}
                                    and #{criterion.secondValue}
                                </when>
                                <when test="criterion.listValue">
                                    and ${criterion.condition}
                                    <foreach collection="criterion.value" item="listItem"
                                             open="(" close=")" separator=",">
                                        #{listItem}
                                    </foreach>
                                </when>
                            </choose>
                        </foreach>
                    </trim>
                </if>
            </foreach>
        </where>
    </sql>
  
  <!-- 分页查询 -->
  <select id="selectPageList" resultMap="BaseResultMap" parameterType="com.xtr.api.domain.company.CompanyBorrowBillsBean">
        SELECT
        <include refid="Base_Column_List"/>
        FROM company_borrow_bills
        WHERE 1=1
        <include refid="Example_Where_Clause"/>
        ORDER BY bill_addtime DESC
  </select>

    <!--查询待还款订单-->
    <select id="selectRepayPageList" resultMap="CompanyRepayAccountResaultMap" parameterType="java.lang.Long">
        SELECT a.bill_id, b.order_id, a.bill_money, a.bill_repaytime, a.bill_addtime, b.order_finance_resion as description
        FROM company_borrow_bills as a left join company_borrow_orders as b
        on a.bill_borrow_order_id = b.order_id
        WHERE a.bill_sign = 0 AND a.bill_company_id = #{companyId,jdbcType=BIGINT}
    </select>

    <!-- 查询最近一个月的还款 -->
    <select id="selectRepayMoney" resultType="java.math.BigDecimal" parameterType="com.xtr.api.basic.GenericCriteria">
        select sum(bill_money) from company_borrow_bills
        <include refid="Criteria_Where_Clause" />
    </select>

    <!--查询借款订单量-->
    <select id="getTodayOrderNum" resultType="java.lang.Integer">
      select count(order_id) from company_borrow_orders
      where to_days(order_addtime) = to_days(now()) and order_type = #{orderType,jdbcType=INTEGER}
    </select>

</mapper>