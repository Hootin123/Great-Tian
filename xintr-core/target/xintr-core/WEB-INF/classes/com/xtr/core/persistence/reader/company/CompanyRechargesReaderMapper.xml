<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xtr.core.persistence.reader.company.CompanyRechargesReaderMapper" >
  <resultMap id="BaseResultMap" type="com.xtr.api.domain.company.CompanyRechargesBean" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
      <id column="recharge_id" jdbcType="BIGINT" property="rechargeId" />
      <result column="recharge_type" jdbcType="INTEGER" property="rechargeType" />
      <result column="recharge_money" jdbcType="DECIMAL" property="rechargeMoney" />
      <result column="recharge_company_id" jdbcType="BIGINT" property="rechargeCompanyId" />
      <result column="excel_id" jdbcType="BIGINT" property="excelId" />
      <result column="recharge_addtime" jdbcType="TIMESTAMP" property="rechargeAddtime" />
      <result column="recharge_number" jdbcType="VARCHAR" property="rechargeNumber" />
      <result column="recharge_serial_number" jdbcType="VARCHAR" property="rechargeSerialNumber" />
      <result column="recharge_bak" jdbcType="VARCHAR" property="rechargeBak" />
      <result column="recharge_station" jdbcType="INTEGER" property="rechargeStation" />
      <result column="recharge_client" jdbcType="INTEGER" property="rechargeClient" />
      <result column="recharge_moneyserver" jdbcType="DECIMAL" property="rechargeMoneyserver" />
      <result column="recharge_bank" jdbcType="VARCHAR" property="rechargeBank" />
      <result column="recharge_bankarea" jdbcType="VARCHAR" property="rechargeBankarea" />
      <result column="recharge_banknumber" jdbcType="VARCHAR" property="rechargeBanknumber" />
      <result column="recharge_moneynow" jdbcType="DECIMAL" property="rechargeMoneynow" />
      <result column="recharge_istoexcel" jdbcType="INTEGER" property="rechargeIstoexcel" />
      <result column="recharge_moneybt" jdbcType="DECIMAL" property="rechargeMoneybt" />
      <result column="recharge_istorecord" jdbcType="INTEGER" property="rechargeIstorecord" />
      <result column="recharge_recall_time" jdbcType="TIMESTAMP" property="rechargeRecallTime" />
      <result column="recharge_recall_result" jdbcType="INTEGER" property="rechargeRecallResult" />
      <result column="recharge_state" jdbcType="INTEGER" property="rechargeState" />
      <result column="recharge_audit_first_time" jdbcType="TIMESTAMP" property="rechargeAuditFirstTime" />
      <result column="recharge_audit_first_member" jdbcType="BIGINT" property="rechargeAuditFirstMember" />
      <result column="recharge_audit_second_time" jdbcType="TIMESTAMP" property="rechargeAuditSecondTime" />
      <result column="recharge_audit_second_member" jdbcType="BIGINT" property="rechargeAuditSecondMember" />
      <result column="bank_account_name" jdbcType="VARCHAR" property="bankAccountName" />
      <result column="bank_subbranch" jdbcType="VARCHAR" property="bankSubbranch" />
      <result column="recharge_audit_first_remark" jdbcType="VARCHAR" property="rechargeAuditFirstRemark" />
      <result column="recharge_name" jdbcType="VARCHAR" property="rechargeName" />
      <result column="recharge_payment_rate" jdbcType="DECIMAL" property="rechargePaymentRate" />
      <result column="recharge_payment_amount" jdbcType="DECIMAL" property="rechargePaymentAmount" />
      <result column="recharge_real_amount" jdbcType="DECIMAL" property="rechargeRealAmount" />
      <result column="recharge_red_id" jdbcType="BIGINT" property="rechargeRedId" />
  </resultMap>

  <sql id="Base_Column_List" >
      recharge_id, recharge_type, recharge_money, recharge_company_id, excel_id, recharge_addtime,
      recharge_number, recharge_serial_number, recharge_bak, recharge_station, recharge_client,
      recharge_moneyserver, recharge_bank, recharge_bankarea, recharge_banknumber, recharge_moneynow,
      recharge_istoexcel, recharge_moneybt, recharge_istorecord, recharge_recall_time,
      recharge_recall_result, recharge_state, recharge_audit_first_time, recharge_audit_first_member,
      recharge_audit_second_time, recharge_audit_second_member, bank_account_name, bank_subbranch,recharge_audit_first_remark,
      recharge_name,recharge_payment_rate,recharge_payment_amount,recharge_real_amount,recharge_red_id
  </sql>

  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    select
    <include refid="Base_Column_List" />
    from company_recharges
    where recharge_id = #{rechargeId,jdbcType=BIGINT}
  </select>
  
  <sql id="Example_Where_Clause">
      <if test="rechargeType != null">
          AND recharge_type = #{rechargeType,jdbcType=INTEGER}
      </if>
      <if test="rechargeMoney != null">
          AND recharge_money = #{rechargeMoney,jdbcType=DECIMAL}
      </if>
      <if test="rechargeCompanyId != null">
          AND recharge_company_id = #{rechargeCompanyId,jdbcType=BIGINT}
      </if>
      <if test="excelId != null">
          AND excel_id = #{excelId,jdbcType=BIGINT}
      </if>

      <if test="rechargeNumber != null">
          AND recharge_number = #{rechargeNumber,jdbcType=VARCHAR}
      </if>
      <if test="rechargeSerialNumber != null">
          AND recharge_serial_number = #{rechargeSerialNumber,jdbcType=VARCHAR}
      </if>
      <if test="rechargeBak != null">
          AND recharge_bak = #{rechargeBak,jdbcType=VARCHAR}
      </if>
      <if test="rechargeStation != null">
          AND recharge_station = #{rechargeStation,jdbcType=INTEGER}
      </if>
      <if test="rechargeClient != null">
          AND recharge_client = #{rechargeClient,jdbcType=INTEGER}
      </if>
      <if test="rechargeMoneyserver != null">
          AND recharge_moneyserver = #{rechargeMoneyserver,jdbcType=DECIMAL}
      </if>
      <if test="rechargeBank != null">
          AND recharge_bank = #{rechargeBank,jdbcType=VARCHAR}
      </if>
      <if test="rechargeBankarea != null">
          AND recharge_bankarea = #{rechargeBankarea,jdbcType=VARCHAR}
      </if>
      <if test="rechargeBanknumber != null">
          AND recharge_banknumber = #{rechargeBanknumber,jdbcType=VARCHAR}
      </if>
      <if test="rechargeMoneynow != null">
          AND recharge_moneynow = #{rechargeMoneynow,jdbcType=DECIMAL}
      </if>
      <if test="rechargeIstoexcel != null">
          AND recharge_istoexcel = #{rechargeIstoexcel,jdbcType=INTEGER}
      </if>
      <if test="rechargeMoneybt != null">
          AND recharge_moneybt = #{rechargeMoneybt,jdbcType=DECIMAL}
      </if>
      <if test="rechargeIstorecord != null">
          AND recharge_istorecord = #{rechargeIstorecord,jdbcType=INTEGER}
      </if>
      <if test="rechargeRecallTime != null">
          AND recharge_recall_time = #{rechargeRecallTime,jdbcType=TIMESTAMP}
      </if>
      <if test="rechargeRecallResult != null">
          AND recharge_recall_result = #{rechargeRecallResult,jdbcType=INTEGER}
      </if>
      <if test="rechargeState != null">
          AND recharge_state = #{rechargeState,jdbcType=INTEGER}
      </if>
      <if test="rechargeAuditFirstTime != null">
          AND recharge_audit_first_time = #{rechargeAuditFirstTime,jdbcType=TIMESTAMP}
      </if>
      <if test="rechargeAuditFirstMember != null">
          AND recharge_audit_first_member = #{rechargeAuditFirstMember,jdbcType=BIGINT}
      </if>
      <if test="rechargeAuditSecondTime != null">
          AND recharge_audit_second_time = #{rechargeAuditSecondTime,jdbcType=TIMESTAMP}
      </if>
      <if test="rechargeAuditSecondMember != null">
          AND recharge_audit_second_member = #{rechargeAuditSecondMember,jdbcType=BIGINT}
      </if>
      <if test="bankAccountName != null">
          AND bank_account_name = #{bankAccountName,jdbcType=VARCHAR}
      </if>
      <if test="bankSubbranch != null">
          AND bank_subbranch = #{bankSubbranch,jdbcType=VARCHAR}
      </if>
      <if test="rechargeAuditFirstRemark != null">
          AND recharge_audit_first_remark = #{rechargeAuditFirstRemark,jdbcType=VARCHAR}
      </if>
  </sql>

    <resultMap type="com.xtr.api.dto.company.CompanyRechargeDto" id="companyRechargeDtoBean" extends="BaseResultMap">
        <result column="user_name" property="nickName"/>
        <result column="company_name" property="companyName"/>
    </resultMap>


    <!-- 分页查询企业流水 -->
    <select id="selectPageRecords" resultMap="companyRechargeDtoBean" parameterType="com.xtr.api.dto.company.CompanyRechargeDto">
        SELECT
        <include refid="Base_Column_List"/>,
        b.user_name,
        c.company_name
        from company_recharges as a
        left join sys_user as b on a.recharge_audit_first_member = b.id
        left join companys as c on a.recharge_company_id = c.company_id
        left join (select * from company_members where member_isdefault = '1' limit 1) as d
        on a.recharge_company_id = d.member_company_id
        WHERE 1=1
        <include refid="Example_Where_Clause" />
        <if test="userName != null">
            AND b.user_name like '%${userName}%'
        </if>
        <if test="companyName != null">
            AND (c.company_name like '%${companyName}%' or d.member_logname = #{companyName})
        </if>
        ORDER BY a.recharge_addtime DESC
    </select>

    <!-- 查询企业充值提现 -->
    <select id="selectCompanyRechargeDto" resultMap="companyRechargeDtoBean" parameterType="java.lang.Long">
        SELECT
        <include refid="Base_Column_List"/>,
        b.user_name,
        c.company_name
        from company_recharges as a
        left join sys_user as b on a.recharge_audit_first_member = b.id
        left join companys as c on a.recharge_company_id = c.company_id
        WHERE a.recharge_id = #{rechargeId,jdbcType=BIGINT}
    </select>

    <select id="selectCompanyRecharge" resultMap="BaseResultMap" parameterType="com.xtr.api.domain.company.CompanyRechargesBean">
        SELECT
        <include refid="Base_Column_List"/>
        from company_recharges where 1=1
        <include refid="Example_Where_Clause"/>
        limit 1
    </select>

    <!--查询今天的订单量-->
    <select id="getTodayOrderNum" resultType="java.lang.Integer">
      select count(recharge_id) from company_recharges
      where to_days(recharge_addtime) = to_days(now()) and recharge_type = #{rechargeType,jdbcType=INTEGER}
    </select>

    <select id="selectByNumber" resultMap="BaseResultMap" >
        select
        <include refid="Base_Column_List" />
        from company_recharges
        where recharge_number = #{rNubmer}
    </select>

    <select id="query" resultMap="BaseResultMap" parameterType="com.xtr.api.basic.QueryParam">
        select
        <include refid="Base_Column_List" />
        from company_recharges where 1=1
        <include refid="Criteria_Where_Clause" />
    </select>

    <sql id="Criteria_Where_Clause">
        <where>
            <foreach collection="whereParams" index="index" item="item">
                and ${index}
                <if test="null != item.first">
                    #{item.first}
                </if>
                <if test="null != item.second">
                    and #{item.second}
                </if>
                <if test="null != item.inParams">
                    <foreach collection="item.inParams" item="arr_val" open=" (" separator="," close=")">
                        #{arr_val}
                    </foreach>
                </if>
            </foreach>
            <if test="null != groupBy">
                group by #{groupBy}
            </if>
            <if test="null != orderBy">
                order by #{orderBy}
            </if>
        </where>
    </sql>

    <!-- 分页查询企业流水 -->
    <select id="selectPageList" resultMap="BaseResultMap" parameterType="com.xtr.api.basic.QueryParam">
        SELECT
        <include refid="Base_Column_List"/>
        FROM company_recharges
        <include refid="Criteria_Where_Clause" />
        ORDER BY recharge_addtime DESC
    </select>

    <!--根据订薪周期查询是否有生成的订单-->
    <select id="selectByExcelIdAndType" resultMap="BaseResultMap" parameterType="com.xtr.api.domain.company.CompanyRechargesBean">
        SELECT
        <include refid="Base_Column_List" />
        FROM company_recharges
        where excel_id=#{excelId,jdbcType=BIGINT} and recharge_type= #{rechargeType,jdbcType=INTEGER}  and (recharge_state=0 or recharge_state=2)
    </select>

    <!--根据订薪周期查询是否存在某个状态的订单-->
    <select id="selectCountByCondition" resultType="java.lang.Integer" parameterType="com.xtr.api.domain.company.CompanyRechargesBean">
        SELECT
        count(1)
        FROM company_recharges
        where excel_id=#{excelId,jdbcType=BIGINT} and recharge_type= #{rechargeType,jdbcType=INTEGER}  and recharge_state=#{rechargeState,jdbcType=INTEGER}
    </select>

    <!--根据订薪周期查询是否存在某个状态的订单信息-->
    <select id="selectListByCondition" resultMap="BaseResultMap" parameterType="com.xtr.api.domain.company.CompanyRechargesBean">
        SELECT
        <include refid="Base_Column_List" />
        FROM company_recharges
        where excel_id=#{excelId,jdbcType=BIGINT} and recharge_type= #{rechargeType,jdbcType=INTEGER}  and recharge_state=#{rechargeState,jdbcType=INTEGER}
        and recharge_company_id=#{rechargeCompanyId,jdbcType=BIGINT}
    </select>
</mapper>