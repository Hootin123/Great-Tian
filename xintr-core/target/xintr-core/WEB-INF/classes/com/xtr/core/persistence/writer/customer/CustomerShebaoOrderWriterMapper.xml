<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xtr.core.persistence.writer.customer.CustomerShebaoOrderWriterMapper" >
  <resultMap id="BaseResultMap" type="com.xtr.api.domain.customer.CustomerShebaoOrderBean" >
  <!--
    WARNING - @mbggenerated
    This element is automatically generated by MyBatis Generator, do not modify.
  -->
  <id column="id" property="id" jdbcType="BIGINT" />
  <result column="customer_id" property="customerId" jdbcType="BIGINT" />
  <result column="company_shebao_order_id" property="companyShebaoOrderId" jdbcType="BIGINT" />
  <result column="shebao_type" property="shebaoType" jdbcType="VARCHAR" />
  <result column="require_type" property="requireType" jdbcType="INTEGER" />
  <result column="order_type" property="orderType" jdbcType="INTEGER" />
  <result column="order_base" property="orderBase" jdbcType="DECIMAL" />
  <result column="overdue_month" property="overdueMonth" jdbcType="DATE" />
  <result column="order_detail" property="orderDetail" jdbcType="VARCHAR" />
  <result column="response_msg" property="responseMsg" jdbcType="VARCHAR" />
  <result column="status" property="status" jdbcType="INTEGER" />
  <result column="payroll_status" property="payrollStatus" jdbcType="INTEGER" />
  <result column="cycle_id" property="cycleId" jdbcType="BIGINT" />
  <result column="org_sum" property="orgSum" jdbcType="DECIMAL" />
  <result column="emp_sum" property="empSum" jdbcType="DECIMAL" />
  <result column="sbt_status" property="sbtStatus" jdbcType="INTEGER" />
  <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
</resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, customer_id, company_shebao_order_id, shebao_type, require_type, order_type,
    order_base, overdue_month, order_detail, response_msg, status, payroll_status, cycle_id,
    org_sum, emp_sum, sbt_status, create_time
  </sql>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from customer_shebao_order
    where id = #{id,jdbcType=BIGINT}
  </delete>

  <delete id="deleteHisOrder">
    DELETE
    FROM
        customer_shebao_order
    WHERE
        customer_id = #{customerId}
    AND company_shebao_order_id = #{companyOrderId}
    AND require_type = #{requireType}
    AND order_type IN (${orderType})
  </delete>

  <insert id="insert" parameterType="com.xtr.api.domain.customer.CustomerShebaoOrderBean" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into customer_shebao_order (customer_id, company_shebao_order_id,
    shebao_type, require_type, order_type,
    order_base, overdue_month, order_detail,
    response_msg, status, payroll_status,
    cycle_id, org_sum, emp_sum,
    sbt_status, create_time)
    values ( #{customerId,jdbcType=BIGINT}, #{companyShebaoOrderId,jdbcType=BIGINT},
    #{shebaoType,jdbcType=VARCHAR}, #{requireType,jdbcType=INTEGER}, #{orderType,jdbcType=INTEGER},
    #{orderBase,jdbcType=DECIMAL}, #{overdueMonth,jdbcType=DATE}, #{orderDetail,jdbcType=VARCHAR},
    #{responseMsg,jdbcType=VARCHAR}, #{status,jdbcType=INTEGER}, #{payrollStatus,jdbcType=INTEGER},
    #{cycleId,jdbcType=BIGINT}, #{orgSum,jdbcType=DECIMAL}, #{empSum,jdbcType=DECIMAL},
    #{sbtStatus,jdbcType=INTEGER}, #{createTime,jdbcType=TIMESTAMP})
  </insert>
  <insert id="insertSelective" parameterType="com.xtr.api.domain.customer.CustomerShebaoOrderBean" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into customer_shebao_order
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="customerId != null" >
        customer_id,
      </if>
      <if test="companyShebaoOrderId != null" >
        company_shebao_order_id,
      </if>
      <if test="shebaoType != null" >
        shebao_type,
      </if>
      <if test="requireType != null" >
        require_type,
      </if>
      <if test="orderType != null" >
        order_type,
      </if>
      <if test="orderBase != null" >
        order_base,
      </if>
      <if test="overdueMonth != null" >
        overdue_month,
      </if>
      <if test="orderDetail != null" >
        order_detail,
      </if>
      <if test="responseMsg != null" >
        response_msg,
      </if>
      <if test="status != null" >
        status,
      </if>
      <if test="payrollStatus != null" >
        payroll_status,
      </if>
      <if test="cycleId != null" >
        cycle_id,
      </if>
      <if test="orgSum != null" >
        org_sum,
      </if>
      <if test="empSum != null" >
        emp_sum,
      </if>
      <if test="sbtStatus != null" >
        sbt_status,
      </if>
      <if test="createTime != null" >
        create_time,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=BIGINT},
      </if>
      <if test="customerId != null" >
        #{customerId,jdbcType=BIGINT},
      </if>
      <if test="companyShebaoOrderId != null" >
        #{companyShebaoOrderId,jdbcType=BIGINT},
      </if>
      <if test="shebaoType != null" >
        #{shebaoType,jdbcType=VARCHAR},
      </if>
      <if test="requireType != null" >
        #{requireType,jdbcType=INTEGER},
      </if>
      <if test="orderType != null" >
        #{orderType,jdbcType=INTEGER},
      </if>
      <if test="orderBase != null" >
        #{orderBase,jdbcType=DECIMAL},
      </if>
      <if test="overdueMonth != null" >
        #{overdueMonth,jdbcType=DATE},
      </if>
      <if test="orderDetail != null" >
        #{orderDetail,jdbcType=VARCHAR},
      </if>
      <if test="responseMsg != null" >
        #{responseMsg,jdbcType=VARCHAR},
      </if>
      <if test="status != null" >
        #{status,jdbcType=INTEGER},
      </if>
      <if test="payrollStatus != null" >
        #{payrollStatus,jdbcType=INTEGER},
      </if>
      <if test="cycleId != null" >
        #{cycleId,jdbcType=BIGINT},
      </if>
      <if test="orgSum != null" >
        #{orgSum,jdbcType=DECIMAL},
      </if>
      <if test="empSum != null" >
        #{empSum,jdbcType=DECIMAL},
      </if>
      <if test="sbtStatus != null" >
        #{sbtStatus,jdbcType=INTEGER},
      </if>
      <if test="createTime != null" >
        #{createTime,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.xtr.api.domain.customer.CustomerShebaoOrderBean" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update customer_shebao_order
    <set >
      <if test="customerId != null" >
        customer_id = #{customerId,jdbcType=BIGINT},
      </if>
      <if test="companyShebaoOrderId != null" >
        company_shebao_order_id = #{companyShebaoOrderId,jdbcType=BIGINT},
      </if>
      <if test="shebaoType != null" >
        shebao_type = #{shebaoType,jdbcType=VARCHAR},
      </if>
      <if test="requireType != null" >
        require_type = #{requireType,jdbcType=INTEGER},
      </if>
      <if test="orderType != null" >
        order_type = #{orderType,jdbcType=INTEGER},
      </if>
      <if test="orderBase != null" >
        order_base = #{orderBase,jdbcType=DECIMAL},
      </if>
      <if test="overdueMonth != null" >
        overdue_month = #{overdueMonth,jdbcType=DATE},
      </if>
      <if test="orderDetail != null" >
        order_detail = #{orderDetail,jdbcType=VARCHAR},
      </if>
      <if test="responseMsg != null" >
        response_msg = #{responseMsg,jdbcType=VARCHAR},
      </if>
      <if test="status != null" >
        status = #{status,jdbcType=INTEGER},
      </if>
      <if test="payrollStatus != null" >
        payroll_status = #{payrollStatus,jdbcType=INTEGER},
      </if>
      <if test="cycleId != null" >
        cycle_id = #{cycleId,jdbcType=BIGINT},
      </if>
      <if test="orgSum != null" >
        org_sum = #{orgSum,jdbcType=DECIMAL},
      </if>
      <if test="empSum != null" >
        emp_sum = #{empSum,jdbcType=DECIMAL},
      </if>
      <if test="sbtStatus != null" >
        sbt_status = #{sbtStatus,jdbcType=INTEGER},
      </if>
      <if test="createTime != null" >
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.xtr.api.domain.customer.CustomerShebaoOrderBean" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update customer_shebao_order
    set customer_id = #{customerId,jdbcType=BIGINT},
    company_shebao_order_id = #{companyShebaoOrderId,jdbcType=BIGINT},
    shebao_type = #{shebaoType,jdbcType=VARCHAR},
    require_type = #{requireType,jdbcType=INTEGER},
    order_type = #{orderType,jdbcType=INTEGER},
    order_base = #{orderBase,jdbcType=DECIMAL},
    overdue_month = #{overdueMonth,jdbcType=DATE},
    order_detail = #{orderDetail,jdbcType=VARCHAR},
    response_msg = #{responseMsg,jdbcType=VARCHAR},
    status = #{status,jdbcType=INTEGER},
    payroll_status = #{payrollStatus,jdbcType=INTEGER},
    cycle_id = #{cycleId,jdbcType=BIGINT},
    org_sum = #{orgSum,jdbcType=DECIMAL},
    emp_sum = #{empSum,jdbcType=DECIMAL},
    sbt_status = #{sbtStatus,jdbcType=INTEGER},
    create_time = #{createTime,jdbcType=TIMESTAMP}
    where id = #{id,jdbcType=BIGINT}
  </update>

  <!--批量删除员工社保公积金订单-->
  <delete id="deleteBatch">
    DELETE
    FROM
    customer_shebao_order
    WHERE
    company_shebao_order_id = #{companyOrderId}
    AND require_type = #{requireType}
    AND customer_id in (${customerId})
    AND order_type IN (${orderType})
  </delete>

  <!--批量新增员工社保公积金订单-->
  <insert id="insertBatch" parameterType="java.util.List" >
    insert into customer_shebao_order (customer_id, company_shebao_order_id,
    shebao_type, require_type, order_type,
    order_base, overdue_month, order_detail,
    response_msg, status, payroll_status,
    cycle_id, org_sum, emp_sum,
    sbt_status, create_time)
    values
    <foreach collection="list" item="item" index="index" separator=",">
      ( #{item.customerId,jdbcType=BIGINT}, #{item.companyShebaoOrderId,jdbcType=BIGINT},
      #{item.shebaoType,jdbcType=VARCHAR}, #{item.requireType,jdbcType=INTEGER}, #{item.orderType,jdbcType=INTEGER},
      #{item.orderBase,jdbcType=DECIMAL}, #{item.overdueMonth,jdbcType=DATE}, #{item.orderDetail,jdbcType=VARCHAR},
      #{item.responseMsg,jdbcType=VARCHAR}, #{item.status,jdbcType=INTEGER}, #{item.payrollStatus,jdbcType=INTEGER},
      #{item.cycleId,jdbcType=BIGINT}, #{item.orgSum,jdbcType=DECIMAL}, #{item.empSum,jdbcType=DECIMAL},
      #{item.sbtStatus,jdbcType=INTEGER}, #{item.createTime,jdbcType=TIMESTAMP})
    </foreach>
  </insert>

  <!--批量更新员工订单的社保通状态-->
  <update id="updateSbtStateBatch">
    update customer_shebao_order
    set sbt_status = #{sbtStatus,jdbcType=INTEGER}
    where company_shebao_order_id = #{companyShebaoOrderId,jdbcType=BIGINT} and customer_id in
    <foreach collection="list" item="item" index="index" open="(" separator="," close=")">
      #{item}
    </foreach>
  </update>

  <!--根据ID批量更新员工订单的社保通状态-->
  <!--<update id="updateSbtStateBatchById">-->
    <!--update customer_shebao_order-->
    <!--set sbt_status = #{sbtStatus,jdbcType=INTEGER}-->
    <!--where company_shebao_order_id = #{companyShebaoOrderId,jdbcType=BIGINT} and id in-->
    <!--<foreach collection="list" item="item" index="index" open="(" separator="," close=")">-->
      <!--#{item}-->
    <!--</foreach>-->
  <!--</update>-->
  <update id="updateSbtStateByCondition" parameterType="com.xtr.api.domain.customer.CustomerShebaoOrderBean">
    update customer_shebao_order
    set sbt_status = #{sbtStatus,jdbcType=INTEGER}
    where company_shebao_order_id = #{companyShebaoOrderId}
    and customer_id=#{customerId}
    and require_type=#{requireType}
    and order_type=#{orderType}
    <if test="overdueMonth != null">
      and overdue_month=#{overdueMonth}
    </if>
  </update>
  <update id="updateNoPayrollOrder">
    UPDATE customer_shebao_order t1
    INNER JOIN company_shebao_order t2 ON t1.company_shebao_order_id = t2.id
    SET t1.cycle_id = #{payCycleId}
    WHERE
        t2.company_id = #{companyId}
    AND DATE_FORMAT(t2.order_date, '%m-%Y') = DATE_FORMAT(#{orderMonth}, '%m-%Y')
    and t1.sbt_status &lt;> 2
    and t1.sbt_status &lt;> 3
  </update>

  <update id="updateSbtStateByNotifiy">
    UPDATE customer_shebao_order set sbt_status = #{sbtStatus}
    where company_shebao_order_id = #{companyOrderId}
    and customer_id = #{customerId}
    and DATE_FORMAT(overdue_month, '%m-%Y') = DATE_FORMAT(#{orderMonth}, '%m-%Y')
    and require_type = #{requireType}
  </update>

  <!--根据相关条件更新员工订单的滞纳费-->
  <update id="updateOverdueByCondition" parameterType="com.xtr.api.domain.customer.CustomerShebaoOrderBean">
    UPDATE customer_shebao_order set shebao_order_overdue = #{shebaoOrderOverdue}
    where company_shebao_order_id = #{companyShebaoOrderId}
    and customer_id = #{customerId}
    and DATE_FORMAT(overdue_month, '%m-%Y') = DATE_FORMAT(#{overdueMonth}, '%m-%Y')
    and require_type = #{requireType}
    and order_type=#{orderType}
  </update>

  <!--更新社保公积金订单社保通状态-->
  <update id="updateSbtStateForPayment" parameterType="com.xtr.api.domain.customer.CustomerShebaoOrderBean">
    UPDATE customer_shebao_order set sbt_status = #{sbtStatus}
    where company_shebao_order_id = #{companyShebaoOrderId}
    and sbt_status !=2 and sbt_status !=3
  </update>

    <!--更新社保公积金订单返回的错误消息-->
    <update id="updateErrorMsg" parameterType="com.xtr.api.domain.customer.CustomerShebaoOrderBean">
        UPDATE customer_shebao_order
        set response_msg=#{responseMsg}
        <if test="sbtStatus != null">
            ,sbt_status=#{sbtStatus}
        </if>
        where company_shebao_order_id = #{companyShebaoOrderId} and customer_id=#{customerId}
        <if test="requireType != null">
            and require_type=#{requireType}
        </if>
        <if test="orderType != null">
            and order_type=#{orderType}
        </if>
        <if test="overdueMonth != null">
            and DATE_FORMAT(overdue_month, '%m-%Y') = DATE_FORMAT(#{overdueMonth}, '%m-%Y')
        </if>
    </update>

    <!--更新成功的社保公积金订单的错误消息为空-->
  <update id="updateErrorMsgForNull" parameterType="com.xtr.api.domain.customer.CustomerShebaoOrderBean">
    UPDATE customer_shebao_order
    set response_msg=NULL,sbt_status=0
    where company_shebao_order_id = #{companyShebaoOrderId} and customer_id=#{customerId}
    <if test="requireType != null">
      and require_type=#{requireType}
    </if>
    <if test="orderType != null">
      and order_type=#{orderType}
    </if>
    <if test="overdueMonth != null">
      and DATE_FORMAT(overdue_month, '%m-%Y') = DATE_FORMAT(#{overdueMonth}, '%m-%Y')
    </if>
  </update>

  <!--批量更新成功的社保公积金订单的错误消息为空-->
  <update id="updateErrorMsgForNullBatch">
    UPDATE customer_shebao_order
    set response_msg=NULL,sbt_status=0
    where
    <foreach collection="list" item="item" index="index" separator="or" >
      (company_shebao_order_id = #{item.companyShebaoOrderId} and  customer_id=#{item.customerId}
        <if test="item.requireType != null">
          and require_type=#{item.requireType}
        </if>
        <if test="item.orderType != null">
          and order_type=#{item.orderType}
        </if>
        <if test="item.overdueMonth != null">
          and DATE_FORMAT(overdue_month, '%m-%Y') = DATE_FORMAT(#{item.overdueMonth}, '%m-%Y')
        </if>
      )
    </foreach>
  </update>

  <!--批量更新社保公积金订单返回的错误消息-->
  <update id="updateErrorMsgBatch">
    UPDATE customer_shebao_order
    <trim prefix="set" suffixOverrides=",">
      <trim prefix="response_msg =case" suffix="end,">
        <foreach collection="list" item="item" index="index">
          <if test="item.responseMsg!=null">
            when (company_shebao_order_id = #{item.companyShebaoOrderId} and  customer_id=#{item.customerId}
            <if test="item.requireType != null">
              and require_type=#{item.requireType}
            </if>
            <if test="item.orderType != null">
              and order_type=#{item.orderType}
            </if>
            <if test="item.overdueMonth != null">
              and DATE_FORMAT(overdue_month, '%m-%Y') = DATE_FORMAT(#{item.overdueMonth}, '%m-%Y')
            </if>
            ) then #{item.responseMsg}
          </if>
        </foreach>
      </trim>
      <trim prefix=" sbt_status =case" suffix="end,">
        <foreach collection="list" item="item" index="index">
          <if test="item.sbtStatus!=null">
            when (company_shebao_order_id = #{item.companyShebaoOrderId} and  customer_id=#{item.customerId}
            <if test="item.requireType != null">
              and require_type=#{item.requireType}
            </if>
            <if test="item.orderType != null">
              and order_type=#{item.orderType}
            </if>
            <if test="item.overdueMonth != null">
              and DATE_FORMAT(overdue_month, '%m-%Y') = DATE_FORMAT(#{item.overdueMonth}, '%m-%Y')
            </if>
            ) then #{item.sbtStatus}
          </if>
        </foreach>
      </trim>
    </trim>
    where
    <foreach collection="list" item="item" index="index" separator="or" >
    (company_shebao_order_id = #{item.companyShebaoOrderId} and  customer_id=#{item.customerId}
    <if test="item.requireType != null">
      and require_type=#{item.requireType}
    </if>
    <if test="item.orderType != null">
      and order_type=#{item.orderType}
    </if>
    <if test="item.overdueMonth != null">
      and DATE_FORMAT(overdue_month, '%m-%Y') = DATE_FORMAT(#{item.overdueMonth}, '%m-%Y')
    </if>
    )
    </foreach>
  </update>

  <!--批量更新社保公积金订单返回的社保通企业与员工支付额度-->
  <update id="updateShebaotongPayBatch">
    UPDATE customer_shebao_order
    <trim prefix="set" suffixOverrides=",">
      <trim prefix="shebaotong_org_pay =case" suffix="end,">
        <foreach collection="list" item="item" index="index">
          <if test="item.shebaotongOrgPay!=null">
            when (company_shebao_order_id = #{item.companyShebaoOrderId} and  customer_id=#{item.customerId}
            <if test="item.requireType != null">
              and require_type=#{item.requireType}
            </if>
            <if test="item.orderType != null">
              and order_type=#{item.orderType}
            </if>
            <if test="item.overdueMonth != null">
              and DATE_FORMAT(overdue_month, '%m-%Y') = DATE_FORMAT(#{item.overdueMonth}, '%m-%Y')
            </if>
            ) then #{item.shebaotongOrgPay}
          </if>
        </foreach>
      </trim>
      <trim prefix=" shebaotong_emp_pay =case" suffix="end,">
        <foreach collection="list" item="item" index="index">
          <if test="item.shebaotongEmpPay!=null">
            when (company_shebao_order_id = #{item.companyShebaoOrderId} and  customer_id=#{item.customerId}
            <if test="item.requireType != null">
              and require_type=#{item.requireType}
            </if>
            <if test="item.orderType != null">
              and order_type=#{item.orderType}
            </if>
            <if test="item.overdueMonth != null">
              and DATE_FORMAT(overdue_month, '%m-%Y') = DATE_FORMAT(#{item.overdueMonth}, '%m-%Y')
            </if>
            ) then #{item.shebaotongEmpPay}
          </if>
        </foreach>
      </trim>
    </trim>
    where
    <foreach collection="list" item="item" index="index" separator="or" >
      (company_shebao_order_id = #{item.companyShebaoOrderId} and  customer_id=#{item.customerId}
      <if test="item.requireType != null">
        and require_type=#{item.requireType}
      </if>
      <if test="item.orderType != null">
        and order_type=#{item.orderType}
      </if>
      <if test="item.overdueMonth != null">
        and DATE_FORMAT(overdue_month, '%m-%Y') = DATE_FORMAT(#{item.overdueMonth}, '%m-%Y')
      </if>
      )
    </foreach>
  </update>
</mapper>