<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:mvc="http://www.springframework.org/schema/mvc" xmlns:aop="http://www.springframework.org/schema/aop"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd">

    <!-- 启用spring mvc 注解 -->
    <context:annotation-config/>
    <!--通知spring使用cglib而不是jdk的来生成代理方法 AOP可以拦截到Controller -->
    <aop:aspectj-autoproxy proxy-target-class="true"/>


    <context:component-scan base-package="com.xtr.manager">
        <context:include-filter type="regex"
                                expression="com.xtr.manager.controller.*"/>
    </context:component-scan>

    <mvc:resources location="/resource/css/" mapping="/resource/css/**"/>
    <mvc:resources location="/resource/js/" mapping="/resource/js/**"/>
    <mvc:resources location="/resource/img/" mapping="/resource/img/**"/>
    <mvc:resources location="/uploadimg/" mapping="/uploadimg/**"/>
    <mvc:resources location="/upload/" mapping="/upload/**"/>
    <mvc:resources location="/resource/ueditor/" mapping="/resource/ueditor/**"/>

    <!--<bean id="validator"-->
    <!--class="org.springframework.validation.beanvalidation.LocalValidatorFactoryBean">-->
    <!--</bean>-->

    <bean class="org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping">
        <property name="order" value="1"/>
    </bean>

    <bean class="org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter">
        <property name="customArgumentResolvers">
            <list>
                <bean class="com.xtr.comm.custom.BeanArgumentResolver"/>
            </list>
        </property>
        <property name="messageConverters">
            <list>
                <bean class="org.springframework.http.converter.StringHttpMessageConverter">
                    <property name="supportedMediaTypes">
                        <list>
                            <value>text/plain;charset=UTF-8</value>
                        </list>
                    </property>
                </bean>

                <bean class="org.springframework.http.converter.json.MappingJackson2HttpMessageConverter">
                    <property name="supportedMediaTypes" value="application/json;charset=UTF-8"/>
                </bean>
                <!--<bean-->
                <!--class="org.springframework.http.converter.json.MappingJacksonHttpMessageConverter">-->
                <!--<property name="supportedMediaTypes" value="application/json;charset=UTF-8" />-->
                <!--</bean>-->
            </list>
        </property>
    </bean>


    <!--<bean-->
            <!--class="org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter">-->
        <!--<property name="customArgumentResolvers">-->
            <!--<list>-->
                <!--<bean class="com.xtr.comm.custom.BeanArgumentResolver"/>-->
            <!--</list>-->
        <!--</property>-->
        <!--<property name="messageConverters">-->
            <!--<list>-->
                <!--<bean-->
                        <!--class="org.springframework.http.converter.StringHttpMessageConverter">-->
                    <!--<property name="supportedMediaTypes">-->
                        <!--<list>-->
                            <!--<value>text/plain;charset=UTF-8</value>-->
                        <!--</list>-->
                    <!--</property>-->
                <!--</bean>-->
                <!--&lt;!&ndash;<bean&ndash;&gt;-->
                <!--&lt;!&ndash;class="org.springframework.http.converter.json.MappingJacksonHttpMessageConverter">&ndash;&gt;-->
                <!--&lt;!&ndash;<property name="supportedMediaTypes" value="application/json;charset=UTF-8"/>&ndash;&gt;-->
                <!--&lt;!&ndash;</bean>&ndash;&gt;-->
            <!--</list>-->
        <!--</property>-->
    <!--</bean>-->


    <!-- 访问路径拦截配置 -->
    <mvc:interceptors>
        <mvc:interceptor>
            <!-- mvc 安全过滤路径 -->
            <mvc:mapping path="/**/*.htm"/>
            <bean class="com.xtr.manager.web.SecurityInterceptor">
                <property name="excludedUrls">
                    <list>
                        <!-- 不需要拦截的url地址 -->
                        <value>.*/login.htm</value>
                        <value>.*/loginOut.htm</value>
                        <value>.*/toLogin.htm</value>
                        <value>.*/isUserExist.htm</value>

                        <value>.*/register.htm</value>
                        <value>.*/isRegister.htm</value>
                        <value>.*/registerUser.htm</value>
                    </list>
                </property>

            </bean>
        </mvc:interceptor>
    </mvc:interceptors>


    <!-- velocity config -->
    <bean id="velocityConfigurer"
          class="org.springframework.web.servlet.view.velocity.VelocityConfigurer">
        <property name="resourceLoaderPath">
            <value>WEB-INF/view</value>
        </property>
        <property name="velocityProperties">
            <props>
                <prop key="input.encoding">UTF-8</prop>
                <prop key="output.encoding">UTF-8</prop>
                <prop key="velocimacro.library">comm/macros.vm</prop>
            </props>
        </property>
    </bean>


    <!-- 处理velocity布局 -->
    <bean id="viewResolver"
          class="org.springframework.web.servlet.view.velocity.VelocityViewResolver">
        <property name="cache" value="true"/>
        <property name="prefix" value=""/>
        <property name="suffix" value=".vm"/>
        <property name="contentType" value="text/html; charset=utf-8"></property>
        <property name="exposeSpringMacroHelpers" value="true"/>
        <property name="requestContextAttribute" value="rc"/>
        <property name="toolboxConfigLocation" value="/WEB-INF/velocity_toolbox.xml"/>
    </bean>

    <bean id="multipartResolver"
          class="org.springframework.web.multipart.commons.CommonsMultipartResolver">
        <!-- 设置上传文件大小的参数 -->
        <property name="maxUploadSize" value="10000000"/>
    </bean>

</beans>